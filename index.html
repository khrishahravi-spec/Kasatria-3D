<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Kasatria 3D Data Tiles</title>

<!-- Google Login -->
<script src="https://accounts.google.com/gsi/client" async defer></script>

<!-- Three.js -->
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/controls/TrackballControls.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/js/renderers/CSS3DRenderer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tweenjs/tween.js@18.6.4/dist/tween.umd.js"></script>

<style>
body {
  margin: 0;
  overflow: hidden;
  background: #000;
  font-family: Arial;
}

.element {
  width: 120px;
  height: 160px;
  border-radius: 10px;
  text-align: center;
  padding-top: 10px;
  color: white;
  box-shadow: 0 0 12px rgba(0,255,255,0.6);
}

.name {
  font-size: 18px;
  font-weight: bold;
}

.title {
  margin-top: 6px;
  font-size: 14px;
}

.worth {
  margin-top: 10px;
  font-size: 16px;
}

#menu {
  position: fixed;
  bottom: 20px;
  width: 100%;
  text-align: center;
}

button {
  padding: 8px 12px;
  margin: 5px;
  cursor: pointer;
}

#login {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 10;
}
</style>
</head>

<body>

<div id="login"></div>

<div id="menu">
  <button onclick="transform(targets.table,2000)">Table</button>
  <button onclick="transform(targets.sphere,2000)">Sphere</button>
  <button onclick="transform(targets.helix,2000)">Helix</button>
  <button onclick="transform(targets.grid,2000)">Grid</button>
</div>

<script>
/* ================= GOOGLE LOGIN ================= */
google.accounts.id.initialize({
  client_id: "495535270825-amr4or2tmcgkoqbkrpkk746n4slalevj.apps.googleusercontent.com",
  callback: () => init()
});

google.accounts.id.renderButton(
  document.getElementById("login"),
  { theme: "outline", size: "large" }
);

/* ================= THREE.JS CORE ================= */
let camera, scene, renderer, controls;
let objects = [];
let targets = { table: [], sphere: [], helix: [], grid: [] };

async function init() {

  camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 1, 10000);
  camera.position.z = 3000;

  scene = new THREE.Scene();

  renderer = new THREE.CSS3DRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  controls = new THREE.TrackballControls(camera, renderer.domElement);

  const data = await loadCSV();
  createObjects(data);
  createTargets(data.length);

  transform(targets.table, 2000);
  animate();
}

/* ================= LOAD GOOGLE SHEET CSV ================= */
/* Uses export CSV (works ONLINE) */
async function loadCSV() {
  const url = "https://docs.google.com/spreadsheets/d/1crSTk74mXX6i11vDQpUAqSJMEZITInkgYw2QK76Vaec/export?format=csv";
  const res = await fetch(url);
  const text = await res.text();
  const rows = text.trim().split("\n").slice(1);

  return rows.map(r => {
    const c = r.split(",");
    return {
      name: c[0],
      title: c[1],
      netWorth: parseInt(c[2])
    };
  });
}

/* ================= CREATE DATA TILES ================= */
function createObjects(data) {

  data.forEach(d => {

    const div = document.createElement("div");
    div.className = "element";

    if (d.netWorth < 100000) div.style.background = "red";
    else if (d.netWorth < 200000) div.style.background = "orange";
    else div.style.background = "green";

    div.innerHTML = `
      <div class="name">${d.name}</div>
      <div class="title">${d.title}</div>
      <div class="worth">$${d.netWorth}</div>
    `;

    const obj = new THREE.CSS3DObject(div);
    obj.position.x = Math.random() * 4000 - 2000;
    obj.position.y = Math.random() * 4000 - 2000;
    obj.position.z = Math.random() * 4000 - 2000;

    scene.add(obj);
    objects.push(obj);
  });
}

/* ================= TARGET LAYOUTS ================= */
function createTargets(count) {

  /* TABLE 20 x 10 */
  for (let i = 0; i < count; i++) {
    const obj = new THREE.Object3D();
    obj.position.x = (i % 20) * 140 - 1400;
    obj.position.y = -(Math.floor(i / 20) % 10) * 180 + 900;
    obj.position.z = 0;
    targets.table.push(obj);
  }

  /* SPHERE */
  for (let i = 0; i < count; i++) {
    const phi = Math.acos(-1 + (2 * i) / count);
    const theta = Math.sqrt(count * Math.PI) * phi;
    const obj = new THREE.Object3D();
    obj.position.setFromSphericalCoords(800, phi, theta);
    targets.sphere.push(obj);
  }

  /* DOUBLE HELIX */
  for (let i = 0; i < count; i++) {
    const obj = new THREE.Object3D();
    const angle = i * 0.5;
    const y = -(i * 10) + 500;

    if (i % 2 === 0) {
      obj.position.x = 800 * Math.cos(angle);
      obj.position.z = 800 * Math.sin(angle);
    } else {
      obj.position.x = 800 * Math.cos(angle + Math.PI);
      obj.position.z = 800 * Math.sin(angle + Math.PI);
    }
    obj.position.y = y;
    targets.helix.push(obj);
  }

  /* GRID 5 x 4 x 10 */
  for (let i = 0; i < count; i++) {
    const obj = new THREE.Object3D();
    obj.position.x = (i % 5) * 400 - 800;
    obj.position.y = (Math.floor(i / 5) % 4) * 400 - 800;
    obj.position.z = Math.floor(i / 20) * 400 - 800;
    targets.grid.push(obj);
  }
}

/* ================= TRANSFORM (LIKE DEMO) ================= */
function transform(targetsArr, duration) {

  TWEEN.removeAll();

  objects.forEach((obj, i) => {
    const target = targetsArr[i];

    new TWEEN.Tween(obj.position)
      .to({
        x: target.position.x,
        y: target.position.y,
        z: target.position.z
      }, duration)
      .easing(TWEEN.Easing.Exponential.InOut)
      .start();
  });
}

/* ================= ANIMATE ================= */
function animate(time) {
  requestAnimationFrame(animate);
  TWEEN.update(time);
  controls.update();
  renderer.render(scene, camera);
}
</script>

</body>
</html>
